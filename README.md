# Address in CosmWasm

## Introduction

* Generally, we are agnostic when it comes to addresses. But blockchain users usually don't.
* The most popular format of representing user address and/or contract address
  is [Bech32](https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki).
* There is an enhanced version of this format,
  named [Bech32m](https://github.com/bitcoin/bips/blob/master/bip-0350.mediawiki).
* In prehistoric times (before version 2.0) of `cosmwasm-std` we have used custom internal address format, now we are
  aligned with the format mostly used in real-life blockchains.

## Address representations

### Human-readable

Address has a form of text that is quite easy to remember for most human beings, like this:

```
cosmwasm1h34lmpywh4upnjdg90cjf4j70aee6z8qqfspugamjp42e4q28kqs8s7vcp
```

`cosmwasm` is a human-readable prefix (HRP) then the separator `1` and the rest (easy to remember ðŸ˜Š).

Usually every chain has its own, unique HRP like `juno`, `osmo` and s.o.

### Canonical

```

BC6BFD848EBD7819C9A82BF124D65E7F739D08E002601E23BB906AACD40A3D81

[188,107,253,132,142,189,120,25,201,168,43,241,36,214,94,127,115,157,8,224,2,96,30,35,187,144,106,172,212,10,61,129]

```

Shorter form of the same address.

## Contract addresses

### Contract addresses in `wasmd`

In `wasmd` contract addresses are generated by these functions:

- unpredictable:
  [BuildContractAddressClassic](https://github.com/CosmWasm/wasmd/blob/96e2b91144c9a371683555f3c696f882583cc6a2/x/wasm/keeper/addresses.go#L36-L41)
- predictable:
  [BuildContractAddressPredictable](https://github.com/CosmWasm/wasmd/blob/96e2b91144c9a371683555f3c696f882583cc6a2/x/wasm/keeper/addresses.go#L49-L72)

### Contract addresses in `cosmwasm-std`

In `cosmwasm-std` a function for generating predictable contract addresses is available:

- predictable:
  [instantiate2_address](https://github.com/CosmWasm/cosmwasm/blob/43c93f4d4be499d13dac813f3039c741ce36eb2e/packages/std/src/addresses.rs#L310-L319)

## Using addresses in tests

### Pure `cosmwasm-std`

Your best friend is `cosmwasm_std::testing::MockApi` who offers you the following services:

- `MockApi::default()` - creates `Api` with default HRP = `cosmwasm`
- `with_prefix(prefix: &'static str)` - creates `Api` with custom prefix, like `juno`, `osmo` and s.o.
- `addr_make(input: &str)` - creates a new `Addr` based on provided input string, in Bech32 format.
- Complete `Api` interface like:
    - `addr_validate`
    - `addr_canonicalize`
    - `addr_humanize`
    - `secp256k1_verify`
    - `secp256k1_recover_pubkey`
    - `ed25519_verify`
    - `ed25519_batch_verify`
    - `debug`

### Pure `cw-multi-test`

Your best friend is this time `App.api()`, that wraps `cosmwasm_std::testing::MockApi`, like this:

```Rust
let app = App::default ();
let human_addr = app.api().addr_make("creator");
println!("Human-readable address: {}", human_addr);
let canonical_addr = app.api().addr_canonicalize(human_addr.as_str()).unwrap();
println!("\nCanonical address: {}", canonical_addr.to_string());
let human_addr = app.api().addr_humanize( & canonical_addr).unwrap();
println!("Human-readable address: {}", human_addr);
let validated_addr = app.api().addr_validate(human_addr.as_str()).unwrap();
println!("     Validated address: {}", validated_addr);
```
